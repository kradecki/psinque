{% extends "templates/masterTemplate.html" %}
{% block title %}My Card{% endblock %}
{% block javascripts %}
<script type="text/javascript" src="http://jzaefferer.github.com/jquery-validation/jquery.validate.js"></script>
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCbYyXY_nwEorG6uOAMY5nf-3yrKx7Agfg&sensor=false"></script>
<script type="text/javascript" src="/javascripts/myCard_view.js"></script>
<script type="text/javascript">
  var emailCounter = {{ emails|length }};
  var addressCounter = {{ addresses|length }};
</script>
{% endblock %}
{% block content %}
  {% if firstlogin %}
  <p>This is your first login, so please fill up your profile below:</p>
  {% endif %}
  <div id="images">
    <img src="/images/linustorvalds.jpg" />
  </div>
  <div id="mycard">
    <table><tr>
      <td class="mycardlabels">Given names</td>
      {% for givenName in userProfile.givenNames %}
      <td class="mycardinputs"><input type="text" id="firstname" value="{{ givenName }}" class="required" minlength="2" /></td>
      <td class="mycardbuttons"><a href="" id="addgivenname"><img src="/images/squareicons/add.png" /></a></td>
      {% else %}
      <td class="mycardinputs"><input type="text" id="firstname" value="" class="required" minlength="2" /></td>
      <td class="mycardbuttons"><a href="" id="addgivenname"><img src="/images/squareicons/add.png" /></a></td>
      {% endfor %}
    </tr></table>
    <table><tr>
      <td class="mycardlabels">Family names</td>
      {% for familyName in userProfile.familyNames %}
      <td class="mycardinputs"><input type="text" id="lastname" value="{{ familyName }}" class="required" minlength="2" /></td>
      {% else %}
      <td class="mycardinputs"><input type="text" id="lastname" value="" class="required" minlength="2" /></td>
      {% endfor %}
    </tr></table>
    <span id="emails">
      {% for email in userEmails %}
      <table class="emailAddress"><tr>
        <td class="mycardlabels">{% if email.primary %}Primary email{% else %}Additional email{% endif %}</td>
        <td class="mycardinputs">
          <input type="hidden" id="emailKey" value="{{ email.key() }}"/>
          <input type="text" id="emailAddress" value="{% if email.email != "primary@nonexistant.com" %}{{ email.email }}{% endif %}" class="{% if not email.primary %}required {% endif %}email" />
        </td>
        <td class="mycardextras">
          <select id="typeofEmail">
          {% for emailTypeCode, emailTypeName in emailTypes.items() %}
            <option value="{{ emailTypeCode }}" {% if emailTypeCode == email.emailType %}selected="selected"{% endif %}>{{ emailTypeName }}</option>
          {% endfor %}
          </select>
        </td>
        {% if loop.first %}
        <td class="mycardbuttons">
          <a href="" id="addEmail"><img src="/images/squareicons/add.png" /></a>
        </td>
        {% endif %}
        {% if not email.primary %}
        <td class="mycardbuttons">
          <a href="" class="emailRemovers"><img src="/images/squareicons/remove.png" /></a>
        </td>
        {% endif %}
      </tr></table>
      {% else %}
      <table class="emailAddress"><tr>
        <td class="mycardlabels">Primary email<td>
        <td class="mycardinputs">
          <input type="hidden" id="emailKey" />
          <input type="text" id="emailAddress" class="required email" />
        </td>
        <td class="mycardextras">
          <select id="typeofEmail">
          {% for emailTypeCode, emailTypeName in emailTypes.items() %}
            <option value="{{ emailTypeCode }}" {% if emailTypeCode == email.emailType %}selected="selected"{% endif %}>{{ emailTypeName }}</option>
          {% endfor %}
          </select>
        </td>
        <td class="mycardbuttons">
          <a href="" id="addEmail"><img src="/images/squareicons/add.png" /></a>
        </td>
      </tr></table>
      {% endfor %}
    </span>
    <span>
      <table><tr>
        <td class="mycardbuttonlabels">
          Save changes
        </td>
        <td class="mycardbuttons">
          <a href="" id="submitButton"><img src="/images/squareicons/save.png" /></a>
        </td>
      </tr></table>
    </span>
<!--    <legend>Physical addresses</legend>
    {% for address in addresses %}
    <p id="address{{ address.nr }}">
    <label>Address:</label>
    <input type="text" name="address{{ address.nr }}" value="{{ address.value.address }}" class="required" />
    <select name="typeofAddress{{ address.nr }}">
    {% for addressTypeCode, addressTypeName in addressTypes.iteritems() %}
        {% if addressTypeCode == address.value.addressType %}
        <option value="{{ addressTypeCode }}" selected="selected">{{ addressTypeName }}</option>
        {% else %}
        <option value="{{ addressTypeCode }}">{{ addressTypeName }}</option>
        {% endif %}
    {% endfor %}
    </select>
    <br />
    <label>Postal code:</label>
    <input type="text" name="postal{{ address.nr }}" value="{{ address.value.postalCode }}" /><br />
    <label>City/town/village:</label>
    <input type="text" name="city{{ address.nr }}" value="{{ address.value.city }}" /><br />

    {% if address.value.location %}
    <span class="hiddenCoordinates">
        <label>Longitude:</label>
        <input type="text" name="long{{ address.nr }}" id="long{{ address.nr }}" value="{{ address.value.location.lon }}" readonly="readonly" /><br />
        <label>Latitude:</label>
        <input type="text" name="lat{{ address.nr }}" id="lat{{ address.nr }}" value="{{ address.value.location.lat }}" readonly="readonly" /><br />
    </span>
    {% endif %}

    <a href="" class="addMap">Find coordinates</a>
    <a href="" class="hideMap">Hide the map</a>
    <a href="" class="showMap">Show the map</a>
    {% if address.nr != 1 %}
        | <a href="" id="remover{{ address.nr }}" class="removers">Remove</a>
    {% endif %}
    </p>
    {% endfor %}
    <p id="addAddress"><a href="">Add address</a></p> -->
<!--     <div id="bottonButton"><input type="button" id="submitButton" value="Apply"/></div> -->
  </div>
  <br style="clear:both;"/>
{% endblock %}