{% extends "templates/master.html" %}
{% import "templates/ui.html" as ui %}
{% block title %}Profile{% endblock %}
{% block stylesheets %}
  <link rel="stylesheet" type="text/css" href="/stylesheets/Profile.css" />
{% endblock %}
{% block externalscripts %}
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCbYyXY_nwEorG6uOAMY5nf-3yrKx7Agfg&sensor=false"></script>
    <script type="text/javascript" src="/javascripts/Profile.js"></script>
{% endblock %}
{% block content %}
  {% if firstlogin %}
  <h3>This is your first login, so please fill up your profile below.</h3>
  {% endif %}
  <div id="photos">
    <img src="/images/nophoto.png" />
  </div>
  <div id="profile">
    {{ ui.beginform() }}
      {{ ui.begintable() }}
        {{ ui.tablelabel("Name", 4) }}
        {{ ui.textinput(userProfile.namePrefix, "Prefix", "prefix", "general") }}
        {{ ui.spacer() }}
        {{ ui.newrow() }}
        {{ ui.textinput(userProfile.givenNames, "Given names", "givennames", "required general") }}
        {{ ui.textinput(userProfile.givenNamesRomanization, "Romanization", "givenroman") }}
        {{ ui.newrow() }}
        {{ ui.textinput(userProfile.familyNames, "Family names", "familynames", "required general") }}
        {{ ui.textinput(userProfile.familyNamesRomanization, "Romanization", "familyroman") }}
        {{ ui.newrow() }}
        {{ ui.textinput(userProfile.nameSuffix, "Suffix", "suffix", "general") }}
        {{ ui.spacer() }}
      {{ ui.endtable() }}
      {{ ui.multipletextinput("Nicknames", "nickname", [], "") }}
      <table id="companystable">
      <tbody>
        {% for company in companies %}
          {% set loopFirst = loop.first %}
          {% set loopIndex = loop.index %}
          {% set itemCount = items|count %}
          {% set itemKey = company.key() %}
          {% set itemValue = company.itemValue %}
          {% include "templates/Profile_Company.html" %}
        {% else %}
          {% set loopFirst = True %}
          {% set loopIndex = 1 %}
          {% set itemCount = 1 %}
          {% set itemKey = "" %}
          {% set itemValue = "" %}
          {% include "templates/Profile_Company.html" %}
        {% endfor %}
      </tbody>
      </table>
      {{ ui.begintable() }}
        {{ ui.tablelabel("Birthday") }}
        {{ ui.dropdown(range(1, 31+1), userProfile.birthDate.day, "birthdays", "nosearch shortbox", "shortinput") }}
        {{ ui.dropdown(months, months[userProfile.birthDate.month-1], "birthmonths", "nosearch shortbox", "shortinput") }}
        {{ ui.dropdown(range(2013, 1899, -1), userProfile.birthDate.year, "birthyears", "nosearch shortbox", "shortinput") }}
          <td class="forminputs sublabel">Gender:</td>
        {{ ui.dropdown(genders, userProfile.gender, "gender", "nosearch shortbox", "shortinput") }}
        {{ ui.spacer() }}
      {{ ui.endtable() }}
      <table id="primaryemailaddress">
      <tbody>
        {% set primary = True %}
        {% set tablelabel = "Primary email" %}
        {% set emailCount = 1 %}
        {% set loopfirst = True %}
        {% set emailkey = primaryEmail.key() %}
        {% set emailaddress = primaryEmail.itemValue %}
        {% set privacyType = primaryEmail.privacyType %}
        {% include "templates/Profile_Email.html" %}
      </tbody>
      </table>
      <table id="additionalemailstable">
      <tbody>
        {% for email in additionalEmails %}
          {% set primary = False %}
          {% set tablelabel = "Additional emails" %}
          {% set emailCount = additionalEmails|count %}
          {% set loopfirst = loop.first %}
          {% set emailkey = email.key() %}
          {% set emailaddress = email.itemValue %}
          {% set privacyType = email.privacyType %}
          {% include "templates/Profile_Email.html" %}
        {% else %}
          {% set primary = False %}
          {% set tablelabel = "Additional emails" %}
          {% set emailCount = 1 %}
          {% set loopfirst = True %}
          {% set emailkey = "" %}
          {% set emailaddress = "" %}
          {% set privacyType = "Home" %}
          {% include "templates/Profile_Email.html" %}
        {% endfor %}
      </tbody>
      </table>
      {{ ui.multipletextinputwithtypes(phones, phoneTypes, privacyTypes, "Phone numbers", "phone") }}
      <table id="imstable">
        <tbody>
          {% set tableLabel = "IM" %}
          {% set prefix = "im" %}
          {% set itemTypes = imTypes %}
          {% for item in ims %}
            {% set loopFirst = loop.first %}
            {% set loopIndex = loop.index %}
            {% set itemCount = ims|count %}
            {% set itemKey = item.key() %}
            {% set itemValue = item.itemValue.address %}
            {% set itemType = item.itemValue.protocol %}
            {% set privacyType = item.privacyType %}
            {% include "templates/Profile_TextItem.html" %}
          {% else %}
            {% set loopFirst = True %}
            {% set loopIndex = 1 %}
            {% set itemCount = 1 %}
            {% set itemKey = "" %}
            {% set itemValue = "" %}
            {% set itemType = "" %}
            {% set privacyType = "Home" %}
            {% set privacyTypes = privacyTypes %}
            {% include "templates/Profile_TextItem.html" %}
          {% endfor %}
        </tbody>
      </table>
      {{ ui.multipletextinputwithtypes(wwws, wwwTypes, privacyTypes, "WWW", "www") }}
      <table>
        <tbody>
          {% for address in addresses %}
            {% set loopFirst = loop.first %}
            {% set loopIndex = loop.index %}
            {% set addressCount = addresses|count %}
            {% set addressKey = address.key() %}
            {% set addressMain = address.address %}
            {% set privacyType = address.privacyType %}
            {% set addressLocation = address.location %}
            {% set city = address.city %}
            {% set country = address.countryCode %}
            {% set postalCode = address.postalCode %}
            {% include "templates/Profile_Address.html" %}
          {% else %}
            {% set loopFirst = True %}
            {% set loopIndex = 1 %}
            {% set addressCount = 1 %}
            {% set addressKey = "" %}
            {% set addressMain = "" %}
            {% set privacyType = "" %}
            {% set addressLocation = None %}
            {% set city = "" %}
            {% set country = "" %}
            {% set postalCode = "" %}
            {% include "templates/Profile_Address.html" %}
          {% endfor %}
        </tbody>
      </table>
      {{ ui.begintable() }}
        {{ ui.tablelabel("Save changes") }}
        {{ ui.savebutton() }}
        {{ ui.spacer() }}
      {{ ui.endtable() }}
    {{ ui.endform() }}
  </div>
  <br style="clear:both;"/>
{% endblock %}
