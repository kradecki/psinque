application: psinque
version: 1
runtime: python27
api_version: 1
threadsafe: true

builtins:
- remote_api: off

libraries:
- name: jinja2
  version: latest
  
handlers:
# Start pages
- url: /
  script: StartPage.app    # checks if the user is logged in and redirects
  secure: optional
- url: /login
  script: StartPage.app    # user not logged in

# User profile viewing and editing
- url: /profile
  script: MyCard.app    # user logged in, shows the visiting card
- url: /editprofile
  script: MyCard.app
- url: /submitprofile
  script: MyCard.app
- url: /uploadphoto
  script: MyCard.app
- url: /uploadphotopost
  script: MyCard.app
- url: /serveimageblob/([^/]+)?
  script: MyCard.app

# Contacts
- url: /contacts
  script: Contacts.app
- url: /searchcontacts
  script: Contacts.app
- url: /addcontact
  script: Contacts.app

# Notifications
- url: /notifications
  script: Notifications.app
- url: /changerelationship    # AJAX queries
  script: Notifications.app

# Under construction
- url: /groups
  script: UnderConstruction.app

# User settings
- url: /settings
  script: Settings.app
- url: /savesettings
  script: Settings.app

# Static pages
- url: /about
  script: StaticPages.app
  
# Static files
- url: /stylesheets
  static_dir: stylesheets
- url: /javascripts
  static_dir: javascripts
- url: /(.*\.(gif|png|jpg))
  static_files: static/\1
  upload: static/(.*\.(gif|png|jpg))
- url: /favicon.ico
  static_files: static/favicon.ico
  upload: static/favicon.ico

# CardDAV
- url: /carddav/*
  secure: always
  script: CardDAV.app

# Error handling
- url: /.*
  script: NotFound.app
